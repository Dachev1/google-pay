## 📊 Flow Diagram:  Google Key Fetching Process

```
┌─────────────────────────────────────────────────────────────┐
│ 1. Client:  provider.getPublicKeys("ECv2")                  │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. fetchKeysIfNeeded() → needsUpdate()?                     │
│    googleKeys == null?  ✅ YES                              │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. fetchGoogleKeys() → HTTP GET                             │
│    → https://payments.developers.google.com/.../keys.json   │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. Google responds:                                         │
│    {                                                        │
│      "keys": [                                              │
│        {"keyValue": "MFkw.. .", "protocolVersion": "ECv2"}, │
│        {"keyValue": "MFkw...", "protocolVersion":  "ECv2"}, │
│        {"keyValue": "MFkw...", "protocolVersion": "ECv1"}   │
│      ]                                                      │
│    }                                                        │
│    Cache-Control: max-age=604800                            │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 5. parseCacheControl() → updateDuration = 7 days            │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 6. parseGoogleKeys() → group by protocolVersion             │ 
│    {                                                        │
│      "ECv2": ["MFkw...", "MFkw..."],                        │
│      "ECv1":  ["MFkw... "]                                  │
│    }                                                        │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 7. Save to cache:                                           │
│    googleKeys = Map                                         │
│    lastUpdated = 2026-01-04T10:30:00Z                       │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 8. Return: ["MFkw...", "MFkw..."] for "ECv2"                │
└─────────────────────────────────────────────────────────────┘
```